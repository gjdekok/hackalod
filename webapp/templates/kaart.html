<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaart van Paramaribo</title>

    <!-- OSD, Overlay en Tailwind  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/3.0.0/openseadragon.min.js"></script>
    <script src="{{ url_for('static', filename='js/openseadragon-svg-overlay.js') }}"></script>
    <script src="//d3js.org/d3.v5.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        #openseadragon {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .source-box {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 10;
        }
        .source-box a {
            color: #00aaff;
            text-decoration: none;
        }
        .source-box a:hover {
            text-decoration: underline;
        }
  
        .tooltip {
            position: absolute;
            padding: 6px 12px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 4px;
            pointer-events: none;
            font-size: 0.9em;
            white-space: nowrap;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="openseadragon">
        <div class="source-box">
            Source: <a href="http://hdl.handle.net/1887.1/item:2013596" target="_blank">Universiteit Leiden</a>
        </div>     
    </div>
    <div class="tooltip" id="tooltip">This is a test!</div>

    <script>
        const viewer = OpenSeadragon({
            id: "openseadragon",
            prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/3.0.0/images/",
            tileSources: "https://iiif.universiteitleiden.nl/iiif/2/hdl:1887.1%252Fitem:2013596",
            defaultZoomLevel: 1.0,
            visibilityRatio: 1,
            constrainDuringPan: true,
            gestureSettingsMouse: {
                scrollToZoom: true,
                clickToZoom: false
            }
        });
    
        viewer.addHandler("open", function() {
    const overlay = viewer.svgOverlay();
    const tooltip = document.getElementById('tooltip');
    const aspectRatio = viewer.source.dimensions.x / viewer.source.dimensions.y;
    const homeBounds = new OpenSeadragon.Rect(0.25, 0, 0.5, 0.5 / aspectRatio);
    viewer.viewport.fitBounds(homeBounds, true);


    const points = [
    {x: 0.34734085596394537, y: 0.18286744339527009}, 
    {x: 0.3493502438240277, y: 0.19572752569979684}, 
    {x: 0.464689106992752, y: 0.19532564812778036}, 
    {x: 0.4630815967046861, y: 0.1796524228191384},
    ];


    const pointsString = points.map(p => `${p.x},${p.y}`).join(" ");


    const polygon = d3.select(overlay.node()).append("polygon")
        .attr("points", pointsString)
        .style("fill", "blue")
        .style("opacity", 0.7)
        .style("cursor", "pointer")
        .on("mouseover", function() {
            tooltip.innerHTML = "Welkom op de Hofstraat!"; 
            tooltip.style.display = "block";
            tooltip.style.opacity = 1;
        })
        .on("mousemove", function() {
            const viewerRect = viewer.element.getBoundingClientRect();
            const tooltipWidth = tooltip.offsetWidth;
            const tooltipHeight = tooltip.offsetHeight;
            
            tooltip.style.left = (d3.event.pageX - tooltipWidth / 2) + 'px';
            tooltip.style.top = (d3.event.pageY - viewerRect.top - tooltipHeight - 10) + 'px';
        })
        .on("mouseout", function() {

            tooltip.style.display = "none";
            tooltip.style.opacity = 0;
        });

    window.addEventListener("resize", () => overlay.resize());
});

viewer.addHandler("canvas-click", function(event) {
    const point = viewer.viewport.pointFromPixel(event.position);
    console.log(`\{x: ${point.x}, y: ${point.y}},`);
});


    </script>
    
</body>
</html>
